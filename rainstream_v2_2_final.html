<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>RAINSTREAM v2.2.0 - ML Pattern Recognition</title><style>*{margin:0;padding:0;box-sizing:border-box}html,body{width:100%;height:100%;overflow:hidden;background:#0a0e27}body{font-family:"Courier New",monospace;color:#00d4ff;display:flex;flex-direction:column}.header{background:linear-gradient(90deg,#00d4ff 0%,#ffed4e 100%);color:#000;padding:8px;text-align:center;font-weight:bold;font-size:1.1em;text-shadow:1px 1px rgba(0,0,0,0.3)}.container{display:flex;flex:1;gap:8px;padding:8px;overflow:hidden}.sidebar{display:flex;flex-direction:column;gap:8px;width:200px;flex-shrink:0}.panel{background:#1a1f3a;border:2px solid #00d4ff;border-radius:6px;padding:10px;overflow-y:auto}.panel h3{color:#ffed4e;font-size:0.85em;margin-bottom:6px;border-bottom:1px solid #00d4ff;padding-bottom:4px}.player-stat{background:rgba(0,212,255,0.08);padding:6px;border-radius:4px;margin:4px 0;border-left:3px solid #00d4ff}.player-name{color:#ffed4e;font-weight:bold;font-size:0.8em}.score-large{color:#00ff88;font-size:1.8em;font-weight:bold;line-height:1}.stat-row{display:flex;justify-content:space-between;font-size:0.7em;color:#00d4ff;margin:2px 0}.timer-display{background:rgba(255,0,0,0.2);border:2px solid #ff4444;border-radius:6px;padding:8px;text-align:center;font-size:2.5em;color:#ff4444;font-weight:bold}.game-area{flex:1;display:flex;flex-direction:column;gap:8px;overflow:hidden}.video-container{flex:1;position:relative;background:#000;border:2px solid #00d4ff;border-radius:6px;overflow:hidden}.video-container video{width:100%;height:100%;object-fit:contain}.canvas-overlay{position:absolute;top:0;left:0;z-index:10}.game-controls{background:#1a1f3a;border:2px solid #00d4ff;border-radius:6px;padding:6px;display:flex;gap:4px;flex-wrap:wrap;align-items:center;overflow:hidden;font-size:0.75em}select{background:#0a0e27;color:#ffed4e;border:1px solid #00d4ff;padding:2px;border-radius:2px;font-size:0.75em}button{background:#00d4ff;color:#000;padding:4px 8px;border:none;border-radius:4px;cursor:pointer;font-weight:bold;font-size:0.7em;white-space:nowrap}button:hover{background:#00ffff}button.active{background:#ff8800}.mode-display{color:#ffed4e;padding:3px 6px;background:rgba(255,136,0,0.2);border-radius:2px;font-weight:bold;border:1px solid #ff8800;white-space:nowrap;font-size:0.7em}.label-select{color:#00d4ff;display:flex;gap:3px;align-items:center;font-size:0.7em}.perf-monitor{background:rgba(0,212,255,0.05);border-left:3px solid #00ff00;padding:4px 6px;border-radius:2px;font-size:0.65em;color:#00ff00;margin:2px 0}.perf-monitor.ml{border-left-color:#00ff00;color:#00ff00}.ml-badge{background:rgba(0,255,0,0.2);border:1px solid #00ff00;color:#00ff00;padding:4px 8px;border-radius:4px;font-size:0.7em;margin:4px 0;font-weight:bold}.help-text{position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,0.85);border:1px solid #00d4ff;padding:8px;font-size:0.7em;color:#00d4ff;border-radius:4px;z-index:5;max-width:150px;line-height:1.4}</style></head><body><div class="header">‚ö° RAINSTREAM v2.2.0 ‚ö° | ML Pattern Recognition + Competitive Gaming</div><div class="container"><div class="sidebar"><div class="panel" style="flex:0 0 auto"><h3>‚è± GAME TIMER</h3><div class="timer-display" id="timer">30</div></div><div class="panel" style="flex:1;overflow-y:auto"><h3>üë§ PLAYERS</h3><div class="player-stat"><div class="player-name">PLAYER 1 (You)</div><div class="score-large" id="p1-score">0</div><div class="stat-row"><span>Acc</span><span id="p1-acc">0%</span></div><div class="stat-row"><span>Hits</span><span id="p1-hits">0</span></div><div class="stat-row"><span>Marks</span><span id="p1-marks">0</span></div></div><div class="player-stat" style="border-left-color:#ffed4e"><div class="player-name" style="color:#ffed4e">PLAYER 2 (CPU)</div><div class="score-large" style="color:#ffaa00" id="p2-score">0</div><div class="stat-row"><span>Acc</span><span id="p2-acc">0%</span></div><div class="stat-row"><span>Hits</span><span id="p2-hits">0</span></div><div class="stat-row"><span>Marks</span><span id="p2-marks">0</span></div></div><div class="player-stat" style="border-left-color:#ff6666"><div class="player-name" style="color:#ff6666">AI OPPONENT</div><div class="score-large" style="color:#ff6666" id="ai-score">0</div><div class="stat-row"><span>Acc</span><span id="ai-acc">0%</span></div><div class="stat-row"><span>Hits</span><span id="ai-hits">0</span></div><div class="stat-row"><span>Marks</span><span id="ai-marks">0</span></div></div></div><div class="panel" style="flex:0 0 auto"><h3>ü§ñ ML ENGINE</h3><div class="ml-badge" id="ml-status">üî¥ OFFLINE</div><div class="perf-monitor ml" id="ml-drops">ML Drops: 0</div><div class="perf-monitor ml" id="ml-time">Infer: 0ms</div></div><div class="panel" style="flex:0 0 auto"><h3>‚öôÔ∏è PERFORMANCE</h3><div class="perf-monitor" id="fps">FPS: 0</div><div class="perf-monitor" id="detect-time">Detect: 0ms</div><div class="perf-monitor" id="memory">Heap: 0MB</div><div class="perf-monitor" id="drops">Drops: 0</div></div></div><div class="game-area"><div class="video-container"><video id="video" muted playsinline></video><canvas id="canvas" class="canvas-overlay"></canvas><div class="help-text">üñä TAP: Mark point<br>üñä DRAG: Draw stream<br>üëÅ AI (3s): Show hints</div></div><div class="game-controls"><label class="label-select"><span>Video:</span><select id="video-select" onchange="loadVideo()"><option value="">Select Video</option><option value="20251224_221145.mp4">Stream 1</option><option value="20251224_221256.mp4">Stream 2</option></select></label><button class="btn" id="play-btn" onclick="play()">‚ñ∂ PLAY</button><button class="btn" onclick="pause()">‚è∏ PAUSE</button><button class="btn" onclick="reset()">üîÑ RESET</button><label class="label-select"><span>Difficulty:</span><select id="difficulty" style="width:70px"><option value="easy">Easy</option><option value="medium" selected>Medium</option><option value="hard">Hard</option><option value="expert">Expert</option></select></label><button class="btn" id="ml-btn" onclick="runMLAnalysis()" style="background:#00ff00;color:#000">ü§ñ ML ANALYZE</button><button class="btn" onclick="showAIOverlay()" style="background:#ff8800">üëÅ AI (3s)</button></div></div></div><script>const GAME_TIME=30000;const TAP_THRESHOLD=250;const TAP_DISTANCE=10;const DETECT_INTERVAL=4;const BRIGHTNESS_THRESHOLD=120;const ML_API="http://localhost:5000";const CURSOR_SVG="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Ccircle cx='12' cy='12' r='8' stroke='%2300d4ff' stroke-width='1.5' fill='none'/%3E%3Ccircle cx='12' cy='12' r='2' fill='%2300d4ff'/%3E%3C/svg%3E";const state={gameRunning:false,gamePaused:false,gameStartTime:0,timeRemaining:GAME_TIME,detecting:true,difficulty:'medium',showAI:false,aiOverlayUntil:0,mlFrames:[],players:{p1:{score:0,marks:[],hits:0,accuracy:0},p2:{score:0,marks:[],hits:0,accuracy:0},ai:{score:0,marks:[],hits:0,accuracy:0}},detectedDrops:[],fps:0,detectTime:0,memoryUsage:0,framesSinceDetect:0,fpsCounter:0,lastFpsTime:Date.now(),lastFrameTime:Date.now()};const video=document.getElementById('video');const canvas=document.getElementById('canvas');const ctx=canvas.getContext('2d');let isDrawing=false;let drawingPath={points:[],type:'line'};let tapStartTime=0;let tapX=0;let tapY=0;function initCanvas(){const rect=canvas.parentElement.getBoundingClientRect();canvas.width=rect.width;canvas.height=rect.height}window.addEventListener('load',initCanvas);window.addEventListener('resize',initCanvas);canvas.style.cursor=`url('${CURSOR_SVG}') 12 12, crosshair`;function loadVideo(){video.src=document.getElementById('video-select').value}function play(){if(state.gameRunning&&state.gamePaused){state.gamePaused=false;video.play();document.getElementById('play-btn').textContent='‚è∏ PAUSE';gameLoop();return}if(state.gameRunning)return;reset();state.gameRunning=true;state.gameStartTime=Date.now();video.play();document.getElementById('play-btn').textContent='‚è∏ PAUSE';gameLoop()}function pause(){state.gamePaused=true;video.pause();document.getElementById('play-btn').textContent='‚ñ∂ PLAY'}function reset(){state.gameRunning=false;state.gamePaused=false;state.timeRemaining=GAME_TIME;state.gameStartTime=0;state.framesSinceDetect=0;state.players={p1:{score:0,marks:[],hits:0,accuracy:0},p2:{score:0,marks:[],hits:0,accuracy:0},ai:{score:0,marks:[],hits:0,accuracy:0}};state.detectedDrops=[];state.mlFrames=[];video.currentTime=0;video.pause();ctx.clearRect(0,0,canvas.width,canvas.height);document.getElementById('play-btn').textContent='‚ñ∂ PLAY';updateUI()}async function runMLAnalysis(){const vid=document.getElementById('video-select').value;if(!vid){alert('Select a video first!');return}document.getElementById('ml-btn').disabled=true;document.getElementById('ml-btn').textContent='ü§ñ ANALYZING...';try{const res=await fetch(ML_API+'/api/analyze',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({video:vid,num_frames:20})});if(!res.ok)throw new Error(`Backend error: ${res.status}`);const data=await res.json();if(data.summary){state.mlFrames=data.frames||[];document.getElementById('ml-status').textContent='üü¢ READY';document.getElementById('ml-drops').textContent=`ML Drops: ${data.summary.total_drops_detected}`;document.getElementById('ml-time').textContent=`Peak: Frame ${data.summary.peak_drop_frame}`;console.log('[‚úì] ML Analysis Complete',data.summary)}}catch(e){console.error('[‚úó] ML Error:',e);document.getElementById('ml-status').textContent='üî¥ ERROR';alert('ML Backend not responding. Make sure it\'s running on port 5000.')}finally{document.getElementById('ml-btn').disabled=false;document.getElementById('ml-btn').textContent='ü§ñ ML ANALYZE'}}function showAIOverlay(){if(!state.gameRunning)return;state.showAI=true;state.aiOverlayUntil=Date.now()+3000}function findDrops(imageData){const data=imageData.data;const points=[];const w=imageData.width;for(let i=0;i<data.length;i+=4){const brightness=(data[i]+data[i+1]+data[i+2])/3;if(brightness>BRIGHTNESS_THRESHOLD){const idx=i/4;const x=idx%w;const y=Math.floor(idx/w);points.push({x,y,b:brightness})}}return clusterPoints(points)}function clusterPoints(points){if(points.length<3)return[];const clusters=[];const used=new Set();for(let i=0;i<points.length;i++){if(used.has(i))continue;const group=[points[i]];used.add(i);for(let j=i+1;j<points.length;j++){if(used.has(j))continue;const dx=points[i].x-points[j].x;const dy=points[i].y-points[j].y;const dist=Math.sqrt(dx*dx+dy*dy);if(dist<25){group.push(points[j]);used.add(j)}}if(group.length>=2){const cx=group.reduce((a,p)=>a+p.x,0)/group.length;const cy=group.reduce((a,p)=>a+p.y,0)/group.length;const cb=group.reduce((a,p)=>a+p.b,0)/group.length;const radius=Math.sqrt(group.length/Math.PI)+2;const confidence=Math.min(1,(cb-BRIGHTNESS_THRESHOLD)/135);clusters.push({x:cx,y:cy,r:radius,con:confidence,hit:false})}}return clusters}function drawFrame(){ctx.clearRect(0,0,canvas.width,canvas.height);const showAI=state.showAI&&Date.now()<state.aiOverlayUntil;if(state.detecting&&state.detectedDrops.length>0&&showAI){state.detectedDrops.forEach(drop=>{ctx.strokeStyle=`rgba(255,237,74,${drop.con})`;ctx.lineWidth=2;ctx.beginPath();ctx.arc(drop.x,drop.y,drop.r,0,Math.PI*2);ctx.stroke();ctx.fillStyle='rgba(255,237,74,0.1)';ctx.fill()})}if(state.mlFrames.length>0){state.mlFrames.forEach(f=>{if(f.drops){f.drops.forEach(d=>{ctx.strokeStyle='rgba(0,255,0,0.2)';ctx.lineWidth=1;ctx.beginPath();ctx.arc(d.x,d.y,d.r,0,Math.PI*2);ctx.stroke()})}})}state.players.p1.marks.forEach(mark=>{ctx.strokeStyle='#00ff88';ctx.lineWidth=2;ctx.beginPath();ctx.arc(mark.x,mark.y,6,0,Math.PI*2);ctx.stroke()});state.players.p2.marks.forEach(mark=>{ctx.strokeStyle='#ffaa00';ctx.lineWidth=2;ctx.beginPath();ctx.arc(mark.x,mark.y,6,0,Math.PI*2);ctx.stroke()});if(isDrawing&&drawingPath.points.length>0){ctx.strokeStyle='rgba(0,255,136,0.5)';ctx.lineWidth=2.5;ctx.lineCap='round';ctx.lineJoin='round';ctx.beginPath();ctx.moveTo(drawingPath.points[0].x,drawingPath.points[0].y);for(let i=1;i<drawingPath.points.length;i++){ctx.lineTo(drawingPath.points[i].x,drawingPath.points[i].y)}ctx.stroke()}}canvas.addEventListener('mousedown',(e)=>{if(!state.gameRunning||state.gamePaused||e.button!==0)return;const rect=canvas.getBoundingClientRect();tapX=e.clientX-rect.left;tapY=e.clientY-rect.top;tapStartTime=Date.now();isDrawing=true;drawingPath={points:[{x:tapX,y:tapY}],type:'line'}});canvas.addEventListener('mousemove',(e)=>{if(!isDrawing)return;const rect=canvas.getBoundingClientRect();const nx=e.clientX-rect.left;const ny=e.clientY-rect.top;const dx=nx-drawingPath.points[drawingPath.points.length-1].x;const dy=ny-drawingPath.points[drawingPath.points.length-1].y;const dist=Math.sqrt(dx*dx+dy*dy);if(dist>2){drawingPath.points.push({x:nx,y:ny})}drawFrame()});canvas.addEventListener('mouseup',(e)=>{if(!isDrawing)return;isDrawing=false;const tapDuration=Date.now()-tapStartTime;const lastPoint=drawingPath.points[drawingPath.points.length-1];const tapDist=Math.sqrt(Math.pow(tapX-lastPoint.x,2)+Math.pow(tapY-lastPoint.y,2));if(tapDuration<TAP_THRESHOLD&&tapDist<TAP_DISTANCE){state.players.p1.marks.push({x:tapX,y:tapY,type:'tap'})}else if(drawingPath.points.length>5){state.players.p1.marks.push({x:tapX,y:tapY,type:'stream',points:drawingPath.points})}checkHits();drawFrame();updateUI()});canvas.addEventListener('mouseleave',()=>{if(isDrawing){isDrawing=false;if(drawingPath.points.length>5){state.players.p1.marks.push({x:tapX,y:tapY,type:'stream',points:drawingPath.points})}checkHits();drawFrame();updateUI()}});canvas.addEventListener('contextmenu',(e)=>{e.preventDefault()});function checkHits(){state.players.p1.marks.forEach(mark=>{state.detectedDrops.forEach(drop=>{if(!drop.hit){const dx=mark.x-drop.x;const dy=mark.y-drop.y;const dist=Math.sqrt(dx*dx+dy*dy);if(dist<drop.r+10){drop.hit=true;state.players.p1.hits++;state.players.p1.score+=Math.round(100*drop.con);}}})});updateUI()}function aiPlay(){if(!state.gameRunning||state.gamePaused)return;const diffModifiers={easy:{accuracy:0.5,speed:800},medium:{accuracy:0.7,speed:600},hard:{accuracy:0.85,speed:400},expert:{accuracy:0.95,speed:200}};const mod=diffModifiers[state.difficulty];if(Math.random()<mod.accuracy){const drop=state.detectedDrops.find(d=>!d.hit);if(drop){drop.hit=true;state.players.p2.hits++;state.players.p2.score+=Math.round(100*drop.con)}}const delay=Math.random()*mod.speed+mod.speed;setTimeout(aiPlay,delay)}function updateUI(){document.getElementById('p1-score').textContent=state.players.p1.score;document.getElementById('p1-hits').textContent=state.players.p1.hits;document.getElementById('p1-acc').textContent=state.players.p1.marks.length>0?Math.round((state.players.p1.hits/(state.players.p1.marks.length))*100)+'%':'0%';document.getElementById('p1-marks').textContent=state.players.p1.marks.length;document.getElementById('p2-score').textContent=state.players.p2.score;document.getElementById('p2-hits').textContent=state.players.p2.hits;document.getElementById('p2-acc').textContent=state.detectedDrops.length>0?Math.round((state.players.p2.hits/(state.detectedDrops.length))*100)+'%':'0%';document.getElementById('p2-marks').textContent=state.detectedDrops.filter(d=>!d.hit).length;document.getElementById('ai-score').textContent=state.players.ai.score;document.getElementById('ai-hits').textContent=state.detectedDrops.filter(d=>d.hit).length;document.getElementById('ai-acc').textContent=state.detectedDrops.length>0?Math.round((state.detectedDrops.filter(d=>d.hit).length/(state.detectedDrops.length))*100)+'%':'0%';document.getElementById('ai-marks').textContent=state.detectedDrops.length;document.getElementById('fps').textContent=`FPS: ${state.fps}`;document.getElementById('detect-time').textContent=`Detect: ${state.detectTime}ms`;document.getElementById('memory').textContent=`Heap: ${state.memoryUsage}MB`;document.getElementById('drops').textContent=`Drops: ${state.detectedDrops.length}`;const timerMs=Math.max(0,state.timeRemaining);const timerSec=Math.ceil(timerMs/1000);document.getElementById('timer').textContent=timerSec;if(timerSec===0&&state.gameRunning){endGame()}}function endGame(){state.gameRunning=false;video.pause();const winner=Math.max(state.players.p1.score,state.players.p2.score,state.players.ai.score);let winnerName='DRAW';if(state.players.p1.score===winner)winnerName='PLAYER 1 WINS!';else if(state.players.p2.score===winner)winnerName='PLAYER 2 WINS!';else if(state.players.ai.score===winner)winnerName='AI WINS!';alert(`GAME OVER!\n${winnerName}\n\nP1: ${state.players.p1.score}\nP2: ${state.players.p2.score}\nAI: ${state.players.ai.score}`)}function gameLoop(){if(!state.gameRunning||state.gamePaused){return}const now=Date.now();state.timeRemaining=GAME_TIME-(now-state.gameStartTime);if(state.timeRemaining<=0){state.timeRemaining=0;endGame();return}state.framesSinceDetect++;if(state.framesSinceDetect>=DETECT_INTERVAL&&state.detecting&&video.readyState===video.HAVE_ENOUGH_DATA){const detectStart=performance.now();const imageData=ctx.getImageData(0,0,canvas.width,canvas.height);state.detectedDrops=findDrops(imageData);state.detectTime=Math.round(performance.now()-detectStart);state.framesSinceDetect=0}const frameNow=Date.now();state.frameTime=frameNow-state.lastFrameTime;state.lastFrameTime=frameNow;state.fpsCounter++;if(frameNow-state.lastFpsTime>=1000){state.fps=state.fpsCounter;state.fpsCounter=0;state.lastFpsTime=frameNow}if(performance.memory){state.memoryUsage=Math.round(performance.memory.usedJSHeapSize/1048576)}drawFrame();updateUI();aiPlay();requestAnimationFrame(gameLoop)}loadVideo();updateUI();document.getElementById('difficulty').addEventListener('change',(e)=>{state.difficulty=e.target.value})</script></body></html>
